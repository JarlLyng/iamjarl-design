<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IAMJARL Design System</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
    header { display: flex; align-items: baseline; gap: 12px; margin-bottom: 24px; }
    .pill { padding: 4px 10px; border-radius: 999px; border: 1px solid rgba(0,0,0,.12); font-size: 12px; }
    h2 { margin-top: 32px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
    .card { border: 1px solid rgba(0,0,0,.12); border-radius: 12px; padding: 12px; }
    .swatch { height: 56px; border-radius: 12px; border: 1px solid rgba(0,0,0,.10); }
    .row { display: flex; justify-content: space-between; gap: 12px; font-size: 13px; margin-top: 8px; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 12px; }
    button { border: 1px solid rgba(0,0,0,.18); border-radius: 10px; padding: 6px 10px; background: white; cursor: pointer; }
    .two { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .small { font-size: 13px; line-height: 1.4; }
    .muted { opacity: 0.75; }
    .list { margin: 8px 0 0 18px; }
    @media (max-width: 720px) { .two { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <header>
    <h1 style="margin:0;">IAMJARL Design System</h1>
    <span class="pill" id="version">v?</span>
    <button id="reload">Reload tokens</button>
  </header>

  <p class="small">Human-friendly viewer for <code>tokens.json</code>. Edit tokens once, reuse everywhere.</p>
  <p class="small muted">
    SwiftUI template: <code>templates/swiftui/DesignTokens.swift</code> Â· Icons: Phosphor
  </p>

  <div class="two">
    <section>
      <h2>Light mode</h2>
      <div id="light" class="grid"></div>
    </section>
    <section>
      <h2>Dark mode</h2>
      <div id="dark" class="grid"></div>
    </section>
  </div>

  <section>
    <h2>Shared state colors</h2>
    <div id="shared" class="grid"></div>
  </section>

  <section>
    <h2>Typography</h2>
    <div id="type" class="card"></div>
  </section>

  <section>
    <h2>Icons</h2>
    <div id="icons" class="card"></div>
  </section>

  <script>
    async function loadTokens() {
      const res = await fetch('./tokens.json', { cache: 'no-store' });
      if (!res.ok) throw new Error('Could not load tokens.json');
      return await res.json();
    }

    function swatchCard(name, value) {
      const el = document.createElement('div');
      el.className = 'card';
      const sw = document.createElement('div');
      sw.className = 'swatch';
      sw.style.background = value;
      const row = document.createElement('div');
      row.className = 'row';

      const left = document.createElement('div');
      left.innerHTML = `<strong>${name}</strong><br/><code>${value}</code>`;

      const btn = document.createElement('button');
      btn.textContent = 'Copy';
      btn.onclick = async () => {
        await navigator.clipboard.writeText(value);
        btn.textContent = 'Copied';
        setTimeout(() => (btn.textContent = 'Copy'), 800);
      };

      row.appendChild(left);
      row.appendChild(btn);
      el.appendChild(sw);
      el.appendChild(row);
      return el;
    }

    function attachCopyHandlers(root) {
      const buttons = root.querySelectorAll('button[data-copy]');
      buttons.forEach((btn) => {
        btn.onclick = async () => {
          const value = btn.getAttribute('data-copy') || '';
          await navigator.clipboard.writeText(value);
          const prev = btn.textContent;
          btn.textContent = 'Copied';
          setTimeout(() => (btn.textContent = prev || 'Copy'), 800);
        };
      });
    }

    function renderMode(container, modeObj) {
      container.innerHTML = '';
      // Pick key swatches that matter most
      const items = [
        ['Primary', modeObj.primary],
        ['On Primary', modeObj.onPrimary],
        ['Background / App', modeObj.background.app],
        ['Background / Muted', modeObj.background.muted],
        ['Background / Card', modeObj.background.card],
        ['Text / Primary', modeObj.text.primary],
        ['Text / Secondary', modeObj.text.secondary],
        ['Text / Tertiary', modeObj.text.tertiary],
        ['Border / Subtle', modeObj.border.subtle]
      ];
      items.forEach(([k,v]) => container.appendChild(swatchCard(k, v)));
    }

    function renderShared(container, sharedObj) {
      container.innerHTML = '';
      Object.entries(sharedObj).forEach(([k,v]) => {
        container.appendChild(swatchCard(k, v));
      });
    }

    function renderType(container, t) {
      container.innerHTML = `
        <div style="display:flex; flex-direction:column; gap:10px;">
          <div><strong>UI font:</strong> <code>${t.family.ui}</code></div>
          <div><strong>Mono:</strong> <code>${t.family.mono}</code></div>
          <div style="display:flex; gap:12px; flex-wrap:wrap;">
            <span class="pill">weights: ${Object.values(t.weights).join(', ')}</span>
            <span class="pill">sizes: ${Object.entries(t.sizes).map(([k,v])=>`${k}:${v}`).join(' | ')}</span>
          </div>
          <div style="margin-top:8px;">
            <div style="font-size:${t.sizes.xxl}px; line-height:${t.lineHeights.xxl}px; font-weight:${t.weights.bold};">Then the Letting Go</div>
            <div style="font-size:${t.sizes.xl}px; line-height:${t.lineHeights.relaxed}px; font-weight:${t.weights.semibold}; margin-top:6px;">A calm, minimal UI with a neon accent.</div>
            <div style="font-size:${t.sizes.base}px; line-height:${t.lineHeights.normal}px; font-weight:${t.weights.regular}; margin-top:8px;">
              Body text should be readable, neutral, and consistent across products.
            </div>
          </div>
        </div>
      `;
    }

    function renderIcons(container, icons) {
      const allowedWeights = icons.weightsAllowed.join(', ');
      const defaultSizes = icons.defaultSizes.join(', ');

      container.innerHTML = `
        <div style="display:flex; flex-direction:column; gap:10px;">

          <div class="row">
            <div><strong>Library:</strong> <code>${icons.library}</code></div>
            <button data-copy="${icons.library}">Copy</button>
          </div>

          <div class="row">
            <div><strong>Default weight:</strong> <code>${icons.defaultWeight}</code></div>
            <button data-copy="${icons.defaultWeight}">Copy</button>
          </div>

          <div class="row">
            <div><strong>Allowed weights:</strong> <code>${allowedWeights}</code></div>
            <button data-copy="${allowedWeights}">Copy</button>
          </div>

          <div class="row">
            <div><strong>Default sizes:</strong> <code>${defaultSizes}</code></div>
            <button data-copy="${defaultSizes}">Copy</button>
          </div>

          <div>
            <strong>Usage rules</strong>
            <ul class="list">
              <li>Use <code>regular</code> for core UI by default.</li>
              <li>Use <code>duotone</code> only for highlights/illustrations, not core navigation.</li>
              <li>Avoid mixing icon weights within the same screen.</li>
              <li>Default icon color is <code>text.primary</code>; use <code>primary</code> for active/emphasis; use <code>error</code> for destructive.</li>
            </ul>
          </div>

        </div>
      `;

      attachCopyHandlers(container);
    }

    async function main() {
      const tokens = await loadTokens();
      document.getElementById('version').textContent = `v${tokens.meta.version}`;

      const light = tokens.tokens.colors.modes.light;
      const dark  = tokens.tokens.colors.modes.dark;
      const shared = tokens.tokens.colors.shared;
      const type = tokens.brand.typography;
      const icons = tokens.brand.icons;

      renderMode(document.getElementById('light'), light);
      renderMode(document.getElementById('dark'), dark);
      renderShared(document.getElementById('shared'), shared);
      renderType(document.getElementById('type'), type);
      renderIcons(document.getElementById('icons'), icons);
    }

    document.getElementById('reload').onclick = () => main().catch(console.error);
    main().catch(console.error);
  </script>
</body>
</html>